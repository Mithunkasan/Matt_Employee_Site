generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               String                @id @default(cuid())
  name             String
  email            String                @unique
  password         String
  role             Role                  @default(EMPLOYEE)
  status           UserStatus            @default(ACTIVE)
  department       String?
  phone            String?
  avatar           String?
  activeSessionId  String?
  activeSessionIp  String?
  activeSessionStartedAt DateTime?
  createdAt        DateTime              @default(now())
  updatedAt        DateTime              @updatedAt
  lastActivityAt   DateTime?
  managerId        String?
  stuckKeyAlert    Boolean               @default(false)
  designation      String?
  LeaveRequest     LeaveRequest[]
  Notification     Notification[]
  attendances      Attendance[]
  dailyReports     DailyReport[]
  assignedProjects Project[]             @relation("AssignedTo")
  createdProjects  Project[]             @relation("CreatedBy")
  assignedTasks    Task[]
  manager          User?                 @relation("ManagerSubordinates", fields: [managerId], references: [id])
  subordinates     User[]                @relation("ManagerSubordinates")
  wfhRequests      WorkFromHomeRequest[]
  reportReplies    DailyReport[]         @relation("ReportReplies")

  @@index([role])
  @@index([lastActivityAt])
  @@map("users")
}

model Project {
  id           String        @id @default(cuid())
  title        String
  description  String?
  status       ProjectStatus @default(PENDING)
  priority     String        @default("MEDIUM")
  startDate    DateTime?
  endDate      DateTime?
  githubLink   String?
  fileUrl      String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  assignedToId String?
  createdById  String
  dailyReports DailyReport[]
  assignedTo   User?         @relation("AssignedTo", fields: [assignedToId], references: [id])
  createdBy    User          @relation("CreatedBy", fields: [createdById], references: [id], onDelete: Cascade)
  tasks        Task[]

  @@index([assignedToId])
  @@index([createdById])
  @@map("projects")
}

model Task {
  id           String        @id @default(cuid())
  title        String
  description  String?
  status       TaskStatus    @default(PENDING)
  priority     String        @default("MEDIUM")
  startDate    DateTime?
  endDate      DateTime?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  projectId    String
  assignedToId String?
  dailyReports DailyReport[]
  assignedTo   User?         @relation(fields: [assignedToId], references: [id])
  project      Project       @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([assignedToId])
  @@map("tasks")
}

model DailyReport {
  id          String   @id @default(cuid())
  reportText  String
  hoursWorked Float?
  date        DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  userId      String
  projectId   String
  taskId      String?
  project     Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  task        Task?    @relation(fields: [taskId], references: [id])
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  replyText    String?
  repliedAt    DateTime?
  repliedById  String?
  repliedBy    User?    @relation("ReportReplies", fields: [repliedById], references: [id])

  @@index([userId])
  @@index([projectId])
  @@index([taskId])
  @@map("daily_reports")
}

model Attendance {
  id            String              @id @default(cuid())
  date          DateTime            @db.Date
  notes         String?
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt
  userId        String
  status        AttendanceStatus    @default(PRESENT)
  totalHours    Float               @default(0)
  isOvertime    Boolean             @default(false)
  overtimeHours Float               @default(0)
  sessions      AttendanceSession[]
  user          User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, date], name: "userId_date")
  @@index([date, status])
  @@map("attendances")
}

model AttendanceSession {
  id            String     @id @default(cuid())
  checkIn       DateTime
  checkOut      DateTime?
  hoursWorked   Float      @default(0)
  isOvertime    Boolean    @default(false)
  overtimeHours Float      @default(0)
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  attendanceId  String
  attendance    Attendance @relation(fields: [attendanceId], references: [id], onDelete: Cascade)

  @@map("attendance_sessions")
}

model LeaveRequest {
  id        Int         @id @default(autoincrement())
  userId    String
  startDate DateTime
  endDate   DateTime
  reason    String
  status    LeaveStatus @default(PENDING)
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  user      User        @relation(fields: [userId], references: [id])
}

model WorkFromHomeRequest {
  id        String      @id @default(cuid())
  userId    String
  startDate DateTime
  endDate   DateTime
  reason    String
  status    LeaveStatus @default(PENDING)
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  user      User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("wfh_requests")
}

model Notification {
  id        Int      @id @default(autoincrement())
  userId    String
  title     String
  message   String
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

enum Role {
  ADMIN
  HR
  BA
  EMPLOYEE
  PA
  INTERN
  MANAGER
  TEAM_LEADER
  TEAM_COORDINATOR
}

enum UserStatus {
  ACTIVE
  INACTIVE
}

enum ProjectStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
}

enum TaskStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LEAVE
  WFH
}

enum LeaveStatus {
  PENDING
  APPROVED
  REJECTED
}
