generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               String         @id @default(cuid())
  name             String
  email            String         @unique
  password         String
  role             Role           @default(EMPLOYEE)
  status           UserStatus     @default(ACTIVE)
  department       String?
  phone            String?
  avatar           String?
  managerId        String?
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  LeaveRequest     LeaveRequest[]
  Notification     Notification[]
  attendances      Attendance[]
  dailyReports     DailyReport[]
  wfhRequests      WorkFromHomeRequest[]
  assignedProjects Project[]      @relation("AssignedTo")
  createdProjects  Project[]      @relation("CreatedBy")
  assignedTasks     Task[]
  manager          User?          @relation("ManagerSubordinates", fields: [managerId], references: [id])
  subordinates     User[]         @relation("ManagerSubordinates")
  lastActivityAt   DateTime?
  stuckKeyAlert    Boolean        @default(false)
  designation      String?

  @@index([role])
  @@index([lastActivityAt])
  @@map("users")
}

model Project {
  id           String        @id @default(cuid())
  title        String
  description  String?
  status       ProjectStatus @default(PENDING)
  priority     String        @default("MEDIUM")
  startDate    DateTime?
  endDate      DateTime?
  githubLink   String?
  fileUrl      String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  assignedToId String?
  createdById  String
  dailyReports DailyReport[]
  tasks        Task[]
  assignedTo   User?         @relation("AssignedTo", fields: [assignedToId], references: [id])
  createdBy    User          @relation("CreatedBy", fields: [createdById], references: [id], onDelete: Cascade)

  @@index([assignedToId])
  @@index([createdById])
  @@map("projects")
}

model Task {
  id           String        @id @default(cuid())
  title        String
  description  String?
  status       TaskStatus    @default(PENDING)
  priority     String        @default("MEDIUM")
  startDate    DateTime?
  endDate      DateTime?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  projectId    String
  assignedToId String?
  project      Project       @relation(fields: [projectId], references: [id], onDelete: Cascade)
  assignedTo   User?         @relation(fields: [assignedToId], references: [id])
  dailyReports DailyReport[]

  @@index([projectId])
  @@index([assignedToId])
  @@map("tasks")
}

model DailyReport {
  id          String   @id @default(cuid())
  reportText  String
  hoursWorked Float?
  date        DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  userId      String
  projectId   String
  taskId      String?
  project     Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  task        Task?    @relation(fields: [taskId], references: [id], onDelete: SetNull)
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([projectId])
  @@index([taskId])
  @@map("daily_reports")
}

model Attendance {
  id         String              @id @default(cuid())
  date       DateTime            @db.Date
  notes      String?
  createdAt  DateTime            @default(now())
  updatedAt  DateTime            @updatedAt
  userId     String
  status     AttendanceStatus    @default(PRESENT)
  totalHours Float               @default(0)
  sessions   AttendanceSession[]
  user       User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, date], name: "userId_date")
  @@index([date, status])
  @@map("attendances")
}

model AttendanceSession {
  id           String     @id @default(cuid())
  checkIn      DateTime
  checkOut     DateTime?
  hoursWorked  Float      @default(0)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  attendanceId String
  attendance   Attendance @relation(fields: [attendanceId], references: [id], onDelete: Cascade)

  @@map("attendance_sessions")
}

model LeaveRequest {
  id        Int         @id @default(autoincrement())
  userId    String
  startDate DateTime
  endDate   DateTime
  reason    String
  status    LeaveStatus @default(PENDING)
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  user      User        @relation(fields: [userId], references: [id])
}

model WorkFromHomeRequest {
  id        String      @id @default(cuid())
  userId    String
  user      User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  startDate DateTime
  endDate   DateTime
  reason    String
  status    LeaveStatus @default(PENDING)
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  @@map("wfh_requests")
}

model Notification {
  id        Int      @id @default(autoincrement())
  userId    String
  title     String
  message   String
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

enum Role {
  ADMIN
  HR
  BA
  MANAGER
  TEAM_LEADER
  EMPLOYEE
  PA
}

enum UserStatus {
  ACTIVE
  INACTIVE
}

enum ProjectStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
}

enum TaskStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LEAVE
  WFH
}

enum LeaveStatus {
  PENDING
  APPROVED
  REJECTED
}
